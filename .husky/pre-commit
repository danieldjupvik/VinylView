#!/usr/bin/env bash
# .husky/pre-commit

# Check if NVM is installed before trying to use it
if [ -s "$HOME/.nvm/nvm.sh" ]; then
  # Load nvm
  export NVM_DIR="$HOME/.nvm"
  \. "$NVM_DIR/nvm.sh"
  
  # Activate the project's node version (reads .nvmrc)
  nvm use
fi

# Sync agent instruction files - use whichever was staged as source
for src in AGENTS.md CLAUDE.md GEMINI.md; do
  if git diff --cached --name-only | grep -q "^$src$"; then
    for dest in AGENTS.md CLAUDE.md GEMINI.md; do
      if [ "$src" != "$dest" ]; then
        git show ":$src" > "$dest"
      fi
    done
    git add AGENTS.md CLAUDE.md GEMINI.md
    break
  fi
done

bunx lint-staged
